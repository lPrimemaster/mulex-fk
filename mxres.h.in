#pragma once
#include <string>
#include <cstdint>
#include <unordered_map>
#include <vector>
#include <zlib.h>
#include "@CMAKE_SOURCE_DIR@/mxlogger.h"

#ifdef _WIN32
#define WIN32_LEAN_AND_MEAN
#include <windows.h>
#endif

namespace mulex
{
#ifdef __linux__
	inline const std::unordered_map<std::string, std::vector<std::uint8_t>>& ResGetAll()
	{
		static std::unordered_map<std::string, std::vector<std::uint8_t>> _mx_resources = {
			@MXRES_MAP_ENTRIES@
		};
		return _mx_resources;
	}
#endif

#ifdef _WIN32
	inline std::vector<std::uint8_t> ResLoadWin32Resource(const std::string& name)
	{
		HRSRC res = FindResource(nullptr);
	}
#endif

	inline std::vector<std::uint8_t> ResGetResource(const std::string& resname)
	{
#ifdef __linux__
		static auto entries = ResGetAll();
		auto res = entries.find(resname);
		if(res == entries.end())
		{
			LogError("[mxres] Failed to fetch resource: <%s>.", resname.c_str());
			return {};
		}

		return res->second;
#else
#endif

		// // Max ratio of 10:1
		// std::uint64_t decompsize = 10 * res->second.size();
		// std::vector<std::uint8_t> decomp(decompsize);
		//
		// if(uncompress(decomp.data(), &decompsize, res->second.data(), res->second.size()) != Z_OK)
		// {
		// 	LogError("[mxres] Failed to decompress resource: <%s>.", resname.c_str());
		// 	return {};
		// }
		//
		// decomp.resize(decompsize);
		//
		// return decomp;
	}
} // namespace mulex
