#pragma once
#include <string>
#include <cstdint>
#include <unordered_map>
#include <vector>
#include <zlib.h>
#include "@CMAKE_SOURCE_DIR@/mxlogger.h"

namespace mulex
{
	inline const std::unordered_map<std::string, std::vector<std::uint8_t>>& ResGetAll()
	{
		static std::unordered_map<std::string, std::vector<std::uint8_t>> _mx_resources = {
			@MXRES_MAP_ENTRIES@
		};
		return _mx_resources;
	}

	inline std::vector<std::uint8_t> ResGetResource(const std::string& resname)
	{
		static auto entries = ResGetAll();
		auto res = entries.find(resname);
		if(res == entries.end())
		{
			LogError("[mxres] Failed to fetch resource: <%s>.", resname.c_str());
			return {};
		}

		// Max ratio of 10:1
		std::uint64_t decompsize = 10 * res->second.size();
		std::vector<std::uint8_t> decomp(decompsize);

		if(uncompress(decomp.data(), &decompsize, res->second.data(), res->second.size()) != Z_OK)
		{
			LogError("[mxres] Failed to decompress resource: <%s>.", resname.c_str());
			return {};
		}

		decomp.resize(decompsize);

		return decomp;
	}
} // namespace mulex
